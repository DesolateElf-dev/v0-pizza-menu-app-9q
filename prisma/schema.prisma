// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_URL")
}

generator client {
  provider = "prisma-client-js"
}

// Tabela de usuários/clientes
model Usuario {
  id          String   @id @default(cuid())
  nome        String
  cpf         String   @unique
  email       String?  @unique
  senha       String?  // hash bcrypt, opcional se quiser permitir pedidos sem cadastro
  telefone    String?
  
  // Endereço completo
  rua         String?
  numero      String?
  complemento String?
  bairro      String?
  cidade      String?
  estado      String?
  cep         String?
  
  criadoEm    DateTime @default(now()) @map("criado_em")
  
  // Relação: um usuário pode ter vários pedidos
  pedidos     Pedido[]

  @@map("usuarios")
}

// Tabela de pizzas do cardápio
model Pizza {
  id          String   @id @default(cuid())
  sabor       String   @unique
  descricao   String?
  precoBase   Decimal  @map("preco_base") @db.Decimal(10, 2)
  imagem      String?  // ← ADICIONE ESTA LINHA
  
  criadoEm    DateTime @default(now()) @map("criado_em")
  
  itensPedido ItemPedido[]

  @@map("pizzas")
}


// Tabela de pedidos
model Pedido {
  id          String   @id @default(cuid())
  usuarioId   String   @map("usuario_id")
  dataPedido  DateTime @default(now()) @map("data_pedido")
  status      String   @default("Recebido")
  valorTotal  Decimal? @map("valor_total") @db.Decimal(10, 2)
  
  // Relação: cada pedido pertence a um usuário
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  // Relação: um pedido pode ter vários itens
  itens       ItemPedido[]

  @@map("pedidos")
}

// Tabela de itens dentro de cada pedido
model ItemPedido {
  id         String  @id @default(cuid())
  pedidoId   String  @map("pedido_id")
  pizzaId    String  @map("pizza_id")
  tamanho    String  // "Pequena", "Média", "Grande"
  quantidade Int
  
  // Relação: cada item pertence a um pedido
  pedido     Pedido  @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  
  // Relação: cada item referencia uma pizza do cardápio
  pizza      Pizza   @relation(fields: [pizzaId], references: [id], onDelete: Restrict)

  @@map("itens_pedido")
}
