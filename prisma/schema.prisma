// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Usuario {
  id          String   @id @default(cuid())
  nome        String
  cpf         String   @unique
  email       String?  @unique
  senha       String?
  telefone    String?
  rua         String?
  numero      String?
  complemento String?
  bairro      String?
  cidade      String?
  estado      String?
  cep         String?
  criadoEm    DateTime @default(now()) @map("criado_em")
  pedidos     Pedido[]

  @@map("usuarios")
}

model Pizza {
  id          String   @id @default(cuid())
  sabor       String   @unique
  descricao   String?
  precoBase   Decimal  @map("preco_base") @db.Decimal(10, 2)
  imagem      String?
  criadoEm    DateTime @default(now()) @map("criado_em")
  itensPedido ItemPedido[]

  @@map("pizzas")
}

model PizzaDoce {
  id          String   @id @default(cuid())
  sabor       String   @unique
  descricao   String?
  precoBase   Decimal  @map("preco_base") @db.Decimal(10, 2)
  imagem      String?
  criadoEm    DateTime @default(now()) @map("criado_em")
  itensPedido ItemPedido[]

  @@map("pizzas_doces")
}

model Bebida {
  id        String   @id @default(cuid())
  nome      String
  volume    String? // ex: 350ml, 1L
  preco     Decimal  @db.Decimal(10, 2)
  imagem    String?
  criadoEm  DateTime @default(now()) @map("criado_em")
  itensPedido ItemPedido[]

  @@map("bebidas")
}

model Pedido {
  id          String   @id @default(cuid())
  usuarioId   String   @map("usuario_id")
  dataPedido  DateTime @default(now()) @map("data_pedido")
  status      String   @default("Recebido")
  valorTotal  Decimal? @map("valor_total") @db.Decimal(10, 2)
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  itens       ItemPedido[]

  @@map("pedidos")
}

model ItemPedido {
  id           String  @id @default(cuid())
  pedidoId     String  @map("pedido_id")
  // ReferÃªncias opcionais para permitir 1 tipo por item
  pizzaId      String? @map("pizza_id")
  pizzaDoceId  String? @map("pizza_doce_id")
  bebidaId     String? @map("bebida_id")

  quantidade   Int

  pedido       Pedido    @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  pizza        Pizza?     @relation(fields: [pizzaId], references: [id], onDelete: Restrict)
  pizzaDoce    PizzaDoce? @relation(fields: [pizzaDoceId], references: [id], onDelete: Restrict)
  bebida       Bebida?    @relation(fields: [bebidaId], references: [id], onDelete: Restrict)

  @@map("itens_pedido")
}
